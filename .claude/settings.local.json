{
  "permissions": {
    "allow": [
      "Bash(cmd.exe /c \"cd /d C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run dev\")",
      "Bash(powershell -Command:*)",
      "Bash(npx tsc:*)",
      "Bash(cmd.exe /c \"cd /d C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run build 2>&1\")",
      "Bash(cmd.exe /c \"cd /d C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run lint 2>&1\")",
      "Bash(cmd.exe /c \"cd /d C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run lint\")",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Update device template cards to match master device template style\n\n- Show template_id as mono subtitle instead of brand/model\n- Move brand/model to card content area\n- Add visible action buttons at bottom \\(Duplicate, Edit, Delete\\)\n- Add Active badge at bottom left\n- Add delete confirmation dialog\n- Match badge colors and layout with master device templates\n\nðŸ¤– Generated with [Claude Code]\\(https://claude.com/claude-code\\)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(sshpass -p '@1996SolaR' ssh root@159.223.224.203 \"cd /opt/solar-diesel-controller && git pull && docker-compose up -d --build\")",
      "Bash(ssh:*)",
      "Bash(scp:*)",
      "Bash(tar:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfix: Fix TypeScript error in dashboard sites query\n\n- Fetch enterprise project IDs first before using in .in\\(\\) query\n- Fixes build error: PostgrestFilterBuilder is not assignable to readonly any[]\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git commit:*)",
      "Bash(git reset:*)",
      "Bash(sshpass -p '@1996SolaR' ssh -o StrictHostKeyChecking=no root@159.223.224.203 \"cd /opt/solar-diesel-controller && git pull\")",
      "WebFetch(domain:volteria.org)",
      "Bash(find:*)",
      "Bash(npm run build:*)",
      "Bash(npx next build)",
      "Bash(cmd.exe /c \"cd C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run build\")",
      "Bash(powershell.exe -Command \"Set-Location ''C:\\\\Users\\\\Hp\\\\volteria\\\\frontend''; npm run build\")",
      "Bash(powershell.exe -Command \"Get-Command node -ErrorAction SilentlyContinue | Select-Object Source; Get-Command npm -ErrorAction SilentlyContinue | Select-Object Source\")",
      "Bash(powershell.exe -Command \"& { if \\(Test-Path ''C:\\\\Program Files\\\\nodejs\\\\npm.cmd''\\) { & ''C:\\\\Program Files\\\\nodejs\\\\npm.cmd'' --version } elseif \\(Test-Path ''C:\\\\Program Files \\(x86\\)\\\\nodejs\\\\npm.cmd''\\) { & ''C:\\\\Program Files \\(x86\\)\\\\nodejs\\\\npm.cmd'' --version } else { Write-Host ''Node.js not found in common locations'' } }\")",
      "Bash(powershell.exe -Command \"& { Set-Location ''C:\\\\Users\\\\Hp\\\\volteria\\\\frontend''; if \\(Test-Path ''.\\\\node_modules\\\\.bin\\\\next.cmd''\\) { & ''.\\\\node_modules\\\\.bin\\\\next.cmd'' build } else { Write-Host ''next not found in node_modules'' } }\")",
      "Bash(powershell.exe -Command \"Test-Path ''C:\\\\Users\\\\Hp\\\\volteria\\\\frontend\\\\src\\\\components\\\\sites\\\\template-sync-status.tsx''\")",
      "Bash(powershell.exe -Command \"Test-Path ''C:\\\\Users\\\\Hp\\\\volteria\\\\frontend\\\\src\\\\app\\\\api\\\\sites\\\\[siteId]\\\\template-sync-status\\\\route.ts''; Test-Path ''C:\\\\Users\\\\Hp\\\\volteria\\\\frontend\\\\src\\\\app\\\\api\\\\sites\\\\[siteId]\\\\sync-templates\\\\route.ts''\")",
      "Bash(npx supabase:*)",
      "Bash(sshpass -p '@1996SolaR' ssh root@159.223.224.203 \"docker exec -i sdc-backend python -c \"\"\nimport os\nfrom supabase import create_client\nurl = os.environ.get\\(''SUPABASE_URL''\\)\nkey = os.environ.get\\(''SUPABASE_SERVICE_KEY''\\)\nsupabase = create_client\\(url, key\\)\n# Get earliest and latest heartbeat\nresult = supabase.table\\(''controller_heartbeats''\\).select\\(''timestamp''\\).order\\(''timestamp'', desc=False\\).limit\\(1\\).execute\\(\\)\nearliest = result.data[0][''timestamp''] if result.data else ''No data''\nresult2 = supabase.table\\(''controller_heartbeats''\\).select\\(''timestamp''\\).order\\(''timestamp'', desc=True\\).limit\\(1\\).execute\\(\\)\nlatest = result2.data[0][''timestamp''] if result2.data else ''No data''\n# Count total\ncount = supabase.table\\(''controller_heartbeats''\\).select\\(''id'', count=''exact''\\).execute\\(\\)\nprint\\(f''Earliest heartbeat: {earliest}''\\)\nprint\\(f''Latest heartbeat: {latest}''\\)\nprint\\(f''Total heartbeats: {count.count}''\\)\n\"\"\")",
      "Bash(sshpass -p '@1996SolaR' ssh root@159.223.224.203 \"docker exec -i sdc-backend python -c \"\"\nimport os\nfrom supabase import create_client\nurl = os.environ.get\\(''SUPABASE_URL''\\)\nkey = os.environ.get\\(''SUPABASE_SERVICE_KEY''\\)\nsupabase = create_client\\(url, key\\)\n\n# Find the site named ''Crusher 1''\nsites = supabase.table\\(''sites''\\).select\\(''id, name''\\).execute\\(\\)\ncrusher_site = next\\(\\(s for s in sites.data if ''Crusher'' in s[''name'']\\), None\\)\nif crusher_site:\n    print\\(f''Site: {crusher_site}''\\)\n    \n    # Get the master device \\(controller\\) for this site\n    master = supabase.table\\(''site_master_devices''\\).select\\(''id, controller_id, device_type''\\).eq\\(''site_id'', crusher_site[''id'']\\).execute\\(\\)\n    print\\(f''Master devices: {master.data}''\\)\n    \n    if master.data:\n        controller_id = master.data[0].get\\(''controller_id''\\)\n        if controller_id:\n            # Get earliest and latest heartbeat for THIS controller\n            earliest = supabase.table\\(''controller_heartbeats''\\).select\\(''timestamp''\\).eq\\(''controller_id'', controller_id\\).order\\(''timestamp'', desc=False\\).limit\\(1\\).execute\\(\\)\n            latest = supabase.table\\(''controller_heartbeats''\\).select\\(''timestamp''\\).eq\\(''controller_id'', controller_id\\).order\\(''timestamp'', desc=True\\).limit\\(1\\).execute\\(\\)\n            count = supabase.table\\(''controller_heartbeats''\\).select\\(''id'', count=''exact''\\).eq\\(''controller_id'', controller_id\\).execute\\(\\)\n            print\\(f''Controller ID: {controller_id}''\\)\n            print\\(f''Earliest heartbeat for this controller: {earliest.data[0][\"\"timestamp\"\"] if earliest.data else \"\"None\"\"}''\\)\n            print\\(f''Latest heartbeat for this controller: {latest.data[0][\"\"timestamp\"\"] if latest.data else \"\"None\"\"}''\\)\n            print\\(f''Total heartbeats for this controller: {count.count}''\\)\n        else:\n            print\\(''No controller_id assigned to master device''\\)\nelse:\n    print\\(''Site not found''\\)\n\"\"\")",
      "Bash(git diff:*)",
      "Bash(sshpass -p '@1996SolaR' ssh -o StrictHostKeyChecking=no root@159.223.224.203 \"cd /opt/solar-diesel-controller && git pull && docker-compose up -d --build\")",
      "Bash(npx:*)",
      "Bash(git -C \"C:/Users/Hp/volteria\" status)",
      "Bash(git -C \"C:/Users/Hp/volteria\" diff --stat)",
      "Bash(git -C \"C:/Users/Hp/volteria\" log --oneline -5)",
      "Bash(git -C \"C:/Users/Hp/volteria\" add \"database/migrations/053_fix_heartbeat_rls.sql\" \"frontend/src/app/api/sites/[siteId]/controller-health/route.ts\" \"frontend/src/app/api/sites/[siteId]/heartbeats/route.ts\" \"frontend/src/app/api/sites/[siteId]/status/route.ts\" \"frontend/src/app/projects/[id]/page.tsx\" \"frontend/src/components/charts/power-flow-chart.tsx\")",
      "Bash(git -C \"C:/Users/Hp/volteria\" commit -m \"$\\(cat <<''EOF''\nfix: Proper RLS policy for heartbeats instead of service key bypass\n\n- Add migration 053_fix_heartbeat_rls.sql to allow anyone to read heartbeats\n- Remove service key bypass from controller-health, heartbeats, status API routes\n- Remove service key bypass from project page\n- Fix recharts dimension warnings by adding minWidth={0} to ResponsiveContainer\n\nHeartbeats are not sensitive data \\(just controller status\\), so the proper fix\nis to update RLS policies rather than bypass them with the service key.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git -C \"C:/Users/Hp/volteria\" push origin main)",
      "Bash(where:*)",
      "Bash(sshpass:*)",
      "Bash(dir /s /b \"C:\\\\Users\\\\Hp\\\\volteria\\\\frontend\\\\src\\\\app\\\\api\")",
      "Bash(curl:*)",
      "Bash(git -C \"C:/Users/Hp/volteria\" add \"frontend/src/app/admin/controllers/wizard/steps/step-cloud-connection.tsx\" \"frontend/src/app/admin/controllers/wizard/steps/step-download-image.tsx\" \"frontend/src/app/admin/controllers/wizard/steps/step-run-tests.tsx\")",
      "Bash(git -C \"C:/Users/Hp/volteria\" commit -m \"$\\(cat <<''EOF''\nfeat: Update wizard to reflect 5-layer controller architecture\n\n- Step 2: Show 5 systemd services \\(system, config, device, control, logging\\)\n- Step 2: Add SSH tunnel service and SQLite database info\n- Step 5: Update config preview with services and SSH settings\n- Step 5: Add SSH tunnel establishment step\n- Step 7: Add 3 new tests \\(service health, SSH tunnel, OTA check\\)\n- Step 7: Update test explanations for all 9 tests\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(tree:*)",
      "Bash(ls:*)",
      "Bash(wc:*)",
      "Bash(python:*)",
      "Bash(del C:UsersHpvolteriatest_register.sh)",
      "Bash(PGPASSWORD=\"Solar@1996\" psql:*)",
      "Bash(cmd /c \"cd C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run build\")",
      "Bash(cmd /c \"cd /d C:\\\\Users\\\\Hp\\\\volteria\\\\frontend && npm run build 2>&1\")",
      "Bash(del \"C:\\\\Users\\\\Hp\\\\volteria\\\\database\\\\migrations\\\\064_add_composite_indexes.sql\")",
      "Bash(npm run dev:*)",
      "Bash(git status:*)",
      "Bash(cat:*)",
      "Bash(npm run lint)",
      "Bash(psql:*)",
      "Bash(npm install:*)",
      "Bash(echo:*)",
      "Bash(/c/Users/Hp/AppData/Roaming/npm/npm.cmd --version)",
      "Bash(powershell.exe -Command \"npm --version\")",
      "Bash(powershell.exe -Command \"Get-Command npm | Select-Object -ExpandProperty Source\")",
      "Bash(powershell.exe -Command \"where.exe npm\")",
      "Bash(powershell.exe:*)",
      "Bash(export PATH=\"$PATH:/c/Program Files/nodejs\")",
      "Bash(npm:*)",
      "Bash(pip install:*)",
      "Bash(timeout 5 python:*)",
      "Bash(PGPASSWORD='Solar@1996' psql:*)",
      "Bash(node -e \"\nconst https = require\\(''https''\\);\nconst tables = [''site_master_devices'', ''site_devices'', ''sites'', ''controllers''];\nlet done = 0;\ntables.forEach\\(table => {\n  const options = {\n    hostname: ''usgxhzdctzthcqxyxfxl.supabase.co'',\n    port: 443,\n    path: ''/rest/v1/'' + table + ''?select=id&limit=1'',\n    method: ''GET'',\n    headers: {\n      ''apikey'': ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzZ3hoemRjdHp0aGNxeHl4ZnhsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTAwOTQ2MywiZXhwIjoyMDgwNTg1NDYzfQ.4iKrB2pv7OVaKv_VY7QoyWQzSPuALcNPNJnD5S3Z74I'',\n      ''Authorization'': ''Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzZ3hoemRjdHp0aGNxeHl4ZnhsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTAwOTQ2MywiZXhwIjoyMDgwNTg1NDYzfQ.4iKrB2pv7OVaKv_VY7QoyWQzSPuALcNPNJnD5S3Z74I''\n    }\n  };\n  const req = https.request\\(options, \\(res\\) => {\n    console.log\\(table + '': '' + \\(res.statusCode === 200 ? ''EXISTS'' : ''NOT FOUND \\('' + res.statusCode + ''\\)''\\)\\);\n    done++;\n    if \\(done === tables.length\\) process.exit\\(0\\);\n  }\\);\n  req.on\\(''error'', \\(\\) => { console.log\\(table + '': ERROR''\\); done++; }\\);\n  req.end\\(\\);\n}\\);\n\")",
      "Bash(node run-migration-068.js:*)",
      "Bash(node -e \"\nconst https = require\\(''https''\\);\nconst options = {\n  hostname: ''usgxhzdctzthcqxyxfxl.supabase.co'',\n  port: 443,\n  path: ''/rest/v1/controller_service_status?select=*&limit=1'',\n  method: ''GET'',\n  headers: {\n    ''apikey'': ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzZ3hoemRjdHp0aGNxeHl4ZnhsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTAwOTQ2MywiZXhwIjoyMDgwNTg1NDYzfQ.4iKrB2pv7OVaKv_VY7QoyWQzSPuALcNPNJnD5S3Z74I'',\n    ''Authorization'': ''Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzZ3hoemRjdHp0aGNxeHl4ZnhsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTAwOTQ2MywiZXhwIjoyMDgwNTg1NDYzfQ.4iKrB2pv7OVaKv_VY7QoyWQzSPuALcNPNJnD5S3Z74I''\n  }\n};\nconst req = https.request\\(options, \\(res\\) => {\n  console.log\\(''Status: '' + res.statusCode\\);\n  let data = '''';\n  res.on\\(''data'', chunk => data += chunk\\);\n  res.on\\(''end'', \\(\\) => console.log\\(''Response: '' + data\\)\\);\n}\\);\nreq.end\\(\\);\n\")",
      "Bash(node -e \"\nconst https = require\\(''https''\\);\nconst KEY = ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzZ3hoemRjdHp0aGNxeHl4ZnhsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTAwOTQ2MywiZXhwIjoyMDgwNTg1NDYzfQ.4iKrB2pv7OVaKv_VY7QoyWQzSPuALcNPNJnD5S3Z74I'';\n\n// Get a site to test with\nfunction makeRequest\\(path, method, body\\) {\n  return new Promise\\(\\(resolve, reject\\) => {\n    const options = {\n      hostname: ''usgxhzdctzthcqxyxfxl.supabase.co'',\n      port: 443,\n      path: ''/rest/v1'' + path,\n      method: method || ''GET'',\n      headers: {\n        ''apikey'': KEY,\n        ''Authorization'': ''Bearer '' + KEY,\n        ''Content-Type'': ''application/json'',\n        ''Prefer'': ''return=representation''\n      }\n    };\n    const req = https.request\\(options, \\(res\\) => {\n      let data = '''';\n      res.on\\(''data'', chunk => data += chunk\\);\n      res.on\\(''end'', \\(\\) => {\n        try { resolve\\(JSON.parse\\(data\\)\\); } catch { resolve\\(data\\); }\n      }\\);\n    }\\);\n    req.on\\(''error'', reject\\);\n    if \\(body\\) req.write\\(JSON.stringify\\(body\\)\\);\n    req.end\\(\\);\n  }\\);\n}\n\nasync function test\\(\\) {\n  // Get a site\n  const sites = await makeRequest\\(''/sites?select=id,name,updated_at&limit=1''\\);\n  if \\(!sites.length\\) {\n    console.log\\(''No sites found''\\);\n    return;\n  }\n  const site = sites[0];\n  console.log\\(''Site:'', site.name\\);\n  console.log\\(''Before update:'', site.updated_at\\);\n\n  // Get a device for this site\n  const devices = await makeRequest\\(''/site_devices?select=id,name&site_id=eq.'' + site.id + ''&limit=1''\\);\n  if \\(!devices.length\\) {\n    console.log\\(''No devices found for this site''\\);\n    return;\n  }\n  const device = devices[0];\n  console.log\\(''Device:'', device.name\\);\n\n  // Update the device \\(just touch it, no actual change\\)\n  await makeRequest\\(''/site_devices?id=eq.'' + device.id, ''PATCH'', { name: device.name }\\);\n  console.log\\(''Device updated''\\);\n\n  // Check if site.updated_at changed \\(it should NOT change because the fix is in frontend, not in DB\\)\n  // The frontend fix updates sites.updated_at when device is edited via the UI\n  console.log\\(''\\\\nNote: The fix is in the frontend \\(device-list.tsx\\).''\\);\n  console.log\\(''When you edit a device through the UI, it now also updates sites.updated_at.''\\);\n  console.log\\(''This makes the sync widget show \"\"Not Synced\"\" correctly.''\\);\n}\n\ntest\\(\\).catch\\(console.error\\);\n\")",
      "Bash(node:*)",
      "Bash(grep:*)",
      "Bash(for f in volteria-config.service volteria-control.service volteria-device.service volteria-logging.service)",
      "Bash(do sed -i '/WatchdogSec/d' \"$f\")",
      "Bash(done)",
      "Bash(timeout:*)",
      "Bash(ping:*)",
      "Bash(choco list:*)",
      "Bash(findstr:*)",
      "Bash(dir \"C:\\\\Program Files\\\\PuTTY\\\\plink.exe\")",
      "Bash(dir \"C:\\\\Program Files \\(x86\\)\\\\PuTTY\\\\plink.exe\")",
      "Bash(python3:*)",
      "Bash(chmod:*)",
      "Bash(icacls \"C:\\\\Users\\\\Hp\\\\.ssh\\\\volteria-deploy\" /inheritance:r /grant:r \"%USERNAME%:F\")",
      "Bash(git -C \"C:/Users/Hp/volteria\" checkout deploy/nginx.conf)",
      "Bash(git -C \"C:/Users/Hp/volteria\" diff deploy/nginx.conf)",
      "mcp__plugin_supabase_supabase__execute_sql",
      "mcp__plugin_supabase_supabase__apply_migration",
      "Skill(update-claudemd)",
      "Bash(git restore:*)",
      "mcp__plugin_supabase_supabase__list_tables",
      "mcp__plugin_supabase_supabase__get_logs",
      "Bash(dir \"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")",
      "Bash(dir \"C:\\\\Program Files \\(x86\\)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")",
      "Bash(taskkill:*)",
      "WebSearch",
      "WebFetch(domain:recharts.github.io)",
      "WebFetch(domain:recharts.org)",
      "mcp__plugin_supabase_supabase__search_docs",
      "Bash(git ls-files:*)",
      "Bash(git update-index:*)",
      "Bash(git show:*)",
      "Bash(C:/Users/Hp/scoop/shims/supabase.exe db push:*)",
      "Bash(dir:*)",
      "Bash(pip show:*)",
      "Bash(C:/Users/Hp/AppData/Roaming/Python/Python314/Scripts/uvicorn.exe:*)",
      "Bash(netstat:*)",
      "Skill(check-logging)",
      "Skill(reflect)",
      "WebFetch(domain:github.com)",
      "mcp__plugin_supabase_supabase__list_projects",
      "mcp__plugin_supabase_supabase__get_advisors",
      "mcp__plugin_supabase_supabase__list_migrations",
      "mcp__plugin_supabase_supabase__list_extensions",
      "Bash(Remove-Item -Force \"C:\\\\Users\\\\Hp\\\\volteria\\\\frontend\\\\.next\\\\dev\\\\lock\")",
      "Bash(unzip:*)",
      "Bash(if not exist \"C:\\\\Users\\\\Hp\\\\volteria\\\\.claude\\\\skills\" mkdir \"C:\\\\Users\\\\Hp\\\\volteria\\\\.claude\\\\skills\")",
      "Bash(git ls-tree:*)",
      "Bash(del nul:*)",
      "Bash(git rm:*)"
    ]
  }
}
